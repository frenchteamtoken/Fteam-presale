<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FTEAM â€” Presale #2 (OUVERTE)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="logo-fteam.png">

  <style>
    :root{--blue:#002395;--white:#fff;--red:#ED2939;--bg:#0b0f19;--card:#12182a;--muted:#b9c6ff99;--line:#2636667a}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#e7ecff;background:linear-gradient(135deg,#0b0f19 0%,#0b1328 60%,#0b0f19 100%)}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    header img{width:56px;height:56px;border-radius:12px;background:#000;object-fit:cover;border:1px solid #2a386b66}
    .brand{display:flex;flex-direction:column}
    .pill{align-self:flex-start;display:inline-flex;gap:8px;align-items:center;background:linear-gradient(90deg,var(--blue),var(--white),var(--red));padding:2px;border-radius:999px}
    .pill span{display:inline-block;background:#0d1330;padding:6px 10px;border-radius:999px;font-weight:700;letter-spacing:.3px}
    h1{font-size:clamp(24px,5vw,38px);line-height:1.1;margin:6px 0 0}
    .sub{opacity:.85;font-size:14px}
    .card{background:linear-gradient(180deg,#111a38,#0b1328);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 12px 30px #0006;margin-top:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
    .kpi{flex:1 1 160px;background:#0f1530;border:1px solid #2a386b66;padding:10px 12px;border-radius:12px}
    .kpi b{display:block}
    .muted{color:var(--muted);font-size:13px}
    .input{display:flex;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0d1430}
    .input input{flex:1;padding:12px 12px;color:#eef3ff;background:transparent;border:none;outline:none;font-size:14px}
    .input .copy{background:#111a3d;color:#cfe0ff;border-left:1px solid var(--line);font-size:14px}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:12px 14px;font-weight:800;color:#0c1330;background:linear-gradient(90deg,var(--blue),var(--white),var(--red));box-shadow:0 6px 18px #0007;font-size:14px}
    .btn[disabled]{opacity:.5;cursor:not-allowed;filter:grayscale(40%)}
    .links a{color:#9ecbff;text-decoration:underline}
    .bar{height:10px;background:#0e1430;border-radius:10px;overflow:hidden;border:1px solid #2a386b66}
    .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--blue),var(--red));width:0%}
    .banner{background:#0E2A17;border:1px solid #1f6a3b;color:#CFF8D2;font-weight:700;padding:8px 12px;border-radius:10px;margin:10px 0 0;font-size:14px}
    .topband{
      position:sticky; top:0; z-index:999;
      background:linear-gradient(90deg,#0d381a,#0f612b);
      color:#d7ffe0; border-bottom:1px solid #1f6a3b80; padding:8px 12px; text-align:center;
      font-weight:700; font-size:13px;
    }
    .topband small{display:block; font-weight:600; opacity:.95}
    footer{margin:24px 0 6px}
  </style>
</head>
<body>
  <!-- Bandeau ouverture -->
  <div class="topband">
    âœ… La prÃ©sale FTEAM #2 est <b>OUVERTE</b> â€” participez <b>sans minimum</b>.
    <small>Prix : <b>1 SOL = 700 000 FTEAM</b> â€¢ Objectif : <b>10 SOL</b></small>
  </div>

  <div class="wrap">
    <header>
      <img src="logo-fteam.png" alt="FTEAM">
      <div class="brand">
        <div class="pill"><span>French Team â€¢ FTEAM</span></div>
        <h1>Presale #2 â€” FTEAM</h1>
        <div class="sub">This token represents the absolute best French community, which powered the token TDM's meteoric rise in 2024.</div>
      </div>
    </header>

    <section class="card">
      <h2 style="margin:0 0 6px">Participer Ã  la prÃ©sale</h2>
      <p class="muted" style="margin-top:0">
        Envoyez <b>SOL</b> depuis un portefeuille compatible (Phantom / Solflare) vers lâ€™adresse ci-dessous.
        Les tokens FTEAM seront distribuÃ©s selon les rÃ¨gles annoncÃ©es.
      </p>
      <p class="muted"><b>Aucun minimum dâ€™investissement</b> â€” vous pouvez participer avec le montant SOL de votre choix.</p>

      <div class="row">
        <div class="kpi"><span class="muted">Prix</span><b>1 SOL = 700 000 FTEAM</b></div>
        <div class="kpi"><span class="muted">Objectif</span><b>10 SOL</b></div>
      </div>

      <!-- Adresse + actions -->
      <div class="row" style="align-items:center">
        <div class="input" style="flex:1">
          <input id="payAddr" readonly value="A8vTWrQQWsSkHRLqwr4Nrv8xvC8RMZAUAiXfZCkf6ikh" />
          <button class="copy btn" onclick="copyAddr()">ðŸ“‹ Copier</button>
        </div>
        <button id="btnPhantom" class="btn" onclick="openPhantom()">Ouvrir dans Phantom (mobile)</button>
      </div>

      <div class="links muted" style="margin-top:6px">
        Si le bouton ne sâ€™ouvre pas : <a id="phantomUL" href="#">ouvrir avec Phantom</a> â€¢ <a id="solanaPay" href="#">Solana Pay</a>
      </div>

      <!-- Progression -->
      <div class="row" id="progressRow" style="margin-top:8px">
        <div style="flex:1">
          <div class="muted">Progression</div>
          <div class="bar"><i id="bar" style="width:0%"></i></div>
          <div class="muted" id="raised">Calculâ€¦</div>
          <div class="muted" id="counterErr" style="display:none;margin-top:4px;color:#ffb3b3">
            â›” Compteur indisponible (RPC). RÃ©essaie plus tard.
          </div>
        </div>
      </div>

      <div class="banner">La prÃ©sale #2 est <b>OUVERTE</b> â€” vous pouvez participer <b>sans minimum</b>.</div>
    </section>

    <footer class="muted">Â© <span id="year"></span> French Team â€” FTEAM</footer>
  </div>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  /* ===== Constantes ===== */
  const PRESALE_ADDRESS = "A8vTWrQQWsSkHRLqwr4Nrv8xvC8RMZAUAiXfZCkf6ikh";
  const RAISE_GOAL_SOL  = 10;
  const LAMPORTS_PER_SOL = 1_000_000_000;

  // RPC en rotation (2 clÃ©s Helius + fallback public)
  const RPC_URLS = [
    "https://mainnet.helius-rpc.com/?api-key=8ff2e734-290b-483b-a65b-c90e0ccdb1ca",
    "https://mainnet.helius-rpc.com/?api-key=bc7aa527-188f-4f0a-bb15-db6bc650b642",
    "https://api.mainnet-beta.solana.com"
  ];

  /* ===== Liens Phantom / Solana Pay ===== */
  function buildLinks(address){
    const phantomUL = new URL('https://phantom.app/ul/v1/pay');
    phantomUL.searchParams.set('recipient', address);
    phantomUL.searchParams.set('network', 'mainnet-beta');
    phantomUL.searchParams.set('label', 'FTEAM Presale #2');
    phantomUL.searchParams.set('message', 'Participer Ã  la prÃ©sale FTEAM #2');
    const solanaPayHref = 'solana:' + address + '?label=FTEAM%20Presale%20%232&message=Participer';
    return { phantomUL: phantomUL.toString(), solanaPay: solanaPayHref };
  }

  (function initLinks(){
    const { phantomUL, solanaPay } = buildLinks(PRESALE_ADDRESS);
    document.getElementById('phantomUL').href = phantomUL;
    document.getElementById('solanaPay').href = solanaPay;
  })();

  function copyAddr(){
    const v = PRESALE_ADDRESS;
    navigator.clipboard.writeText(v).then(()=>{
      const btn=document.querySelector('.copy'); const old=btn.textContent;
      btn.textContent='âœ” CopiÃ©'; setTimeout(()=>btn.textContent=old,1200);
    });
  }

  function openPhantom(){
    const { phantomUL, solanaPay } = buildLinks(PRESALE_ADDRESS);
    const ua = navigator.userAgent || '';
    const isMobile  = /Android|iPhone|iPad|iPod/i.test(ua);
    const isAndroid = /Android/i.test(ua);
    if (isAndroid){
      const intent = 'intent://' + phantomUL.replace('https://','') + '#Intent;scheme=https;package=app.phantom;end';
      window.location.href = intent;
      setTimeout(()=>{ window.location.href = solanaPay; }, 1200);
      return;
    }
    if (isMobile){
      window.location.href = phantomUL;
      setTimeout(()=>{ window.location.href = solanaPay; }, 1200);
    } else {
      alert("Sur ordinateur : ouvrez lâ€™extension Phantom, cliquez sur Envoyer et collez lâ€™adresse copiÃ©e.");
      window.open('https://phantom.app/','_blank');
    }
  }

  /* ===== RPC helper (rotation + timeouts) ===== */
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  async function rpc(method, params, {timeoutMs=9000} = {}){
    let lastErr;
    for (const url of RPC_URLS){
      try{
        const ctrl = new AbortController();
        const t = setTimeout(()=>ctrl.abort(), timeoutMs);
        const r = await fetch(url, {
          method:"POST",
          headers:{"content-type":"application/json"},
          body:JSON.stringify({jsonrpc:"2.0",id:1,method,params}),
          signal: ctrl.signal
        });
        clearTimeout(t);
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const j = await r.json();
        if(j.error) throw new Error(`RPC ${j.error.code}: ${j.error.message}`);
        return j.result;
      }catch(e){
        lastErr = e;
        // petite pause avant de tester l'URL suivante
        await sleep(250);
      }
    }
    throw lastErr || new Error("RPC failed");
  }

  /* ===== Lecture des transactions entrantes vers lâ€™adresse ===== */
  async function* signaturesForAddress(address){
    let before = null;
    while(true){
      const res = await rpc("getSignaturesForAddress", [address, {limit:1000, before}]);
      if(!res || !res.length) break;
      for(const s of res) yield s;
      before = res[res.length-1].signature;
      await sleep(250);
    }
  }

  async function computeRaisedSOL(){
    let lamportsIn = 0;
    const sigs = [];

    // On rÃ©cupÃ¨re un gros batch de signatures rÃ©centes
    for await (const s of signaturesForAddress(PRESALE_ADDRESS)){
      if(s.err) continue;
      sigs.push(s.signature);
      if(sigs.length >= 1500) break;
    }

    // Puis on lit les transactions par paquets
    for(let i=0;i<sigs.length;i+=100){
      const chunk = sigs.slice(i,i+100);
      const txs = await rpc("getParsedTransactions", [chunk, {maxSupportedTransactionVersion:0}]);
      for(const tx of txs||[]){
        if(!tx || tx.meta?.err) continue;
        const insts = tx.transaction?.message?.instructions || [];
        for(const ins of insts){
          const info = ins.parsed?.info;
          if(ins.program==="system" && ins.parsed?.type==="transfer" && info?.destination===PRESALE_ADDRESS){
            lamportsIn += Number(info.lamports||0);
          }
        }
      }
      await sleep(200);
    }

    return lamportsIn / LAMPORTS_PER_SOL;
  }

  function setProgressUI(raised){
    const pct = Math.min(100,(raised/RAISE_GOAL_SOL)*100);
    document.getElementById("raised").textContent =
      `${raised.toFixed(2)} SOL levÃ©s / objectif ${RAISE_GOAL_SOL} SOL`;
    document.getElementById("bar").style.width = pct.toFixed(1)+"%";
  }

  async function updateProgress(){
    try{
      const raised = await computeRaisedSOL();
      setProgressUI(raised);
      document.getElementById("counterErr").style.display="none";
    }catch(e){
      document.getElementById("counterErr").style.display="block";
      console.warn("Compteur erreur:", e);
    }
  }

  // Lancement : mise Ã  jour immÃ©diate puis toutes les 60 s
  updateProgress();
  setInterval(updateProgress, 60_000);
</script>
</body>
</html>
