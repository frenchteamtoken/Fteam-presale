<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FTEAM ‚Äî Presale</title>

  <!-- Police & Favicon -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="logo-fteam.png">

  <!-- Styles -->
  <style>
    :root{--blue:#002395;--white:#fff;--red:#ED2939;--bg:#0b0f19;--card:#12182a;--muted:#b9c6ff99;--line:#2636667a}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#e7ecff;background:linear-gradient(135deg,#0b0f19 0%,#0b1328 60%,#0b0f19 100%)}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    header img{width:56px;height:56px;border-radius:12px;background:#000;object-fit:cover;border:1px solid #2a386b66}
    .brand{display:flex;flex-direction:column}
    .pill{align-self:flex-start;display:inline-flex;gap:8px;align-items:center;background:linear-gradient(90deg,var(--blue),var(--white),var(--red));padding:2px;border-radius:999px}
    .pill span{display:inline-block;background:#0d1330;padding:6px 10px;border-radius:999px;font-weight:700;letter-spacing:.3px}
    h1{font-size:clamp(24px,5vw,38px);line-height:1.1;margin:6px 0 0}
    .sub{opacity:.85;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    @media(min-width:860px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:linear-gradient(180deg,#111a38,#0b1328);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 12px 30px #0006}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
    .kpi{flex:1 1 160px;background:#0f1530;border:1px solid #2a386b66;padding:10px 12px;border-radius:12px}
    .kpi b{display:block}
    .muted{color:var(--muted);font-size:13px}
    .input{display:flex;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0d1430}
    .input input{flex:1;padding:12px 12px;color:#eef3ff;background:transparent;border:none;outline:none;font-size:14px}
    .input .copy{background:#111a3d;color:#cfe0ff;border-left:1px solid #2a386b66;font-size:14px}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:12px 14px;font-weight:800;color:#0c1330;background:linear-gradient(90deg,var(--blue),var(--white),var(--red));box-shadow:0 6px 18px #0007;font-size:14px}
    .links a{color:#9ecbff;text-decoration:underline}
    .bar{height:10px;background:#0e1430;border-radius:10px;overflow:hidden;border:1px solid #2a386b66}
    .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--blue),var(--red));width:0%}
    .banner{display:none;background:#8b0b1a;color:#fff;font-weight:700;padding:8px 12px;border-radius:10px;border:1px solid #ff9aa9;margin:10px 0 0;font-size:14px}
    .banner small{display:block;font-weight:600;opacity:.95}
    ul.steps{padding-left:18px}
    ul.steps li{margin:8px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="logo-fteam.png" alt="FTEAM">
      <div class="brand">
        <div class="pill"><span>French Team ‚Ä¢ FTEAM</span></div>
        <h1>Presale officielle FTEAM</h1>
        <div class="sub">This token represents the absolute best French community, which powered the token TDM's meteoric rise in 2024.</div>
      </div>
    </header>

    <div class="grid">
      <!-- Carte participation -->
      <section class="card">
        <h2 style="margin:0 0 6px">Participer √† la pr√©sale</h2>
        <p class="muted" style="margin-top:0">
          Envoyez <b>SOL</b> depuis un portefeuille compatible (Phantom / Solflare) vers l'adresse ci-dessous.
          Les tokens FTEAM seront distribu√©s √† la cl√¥ture.
        </p>

        <p class="muted"><b>Aucun minimum d‚Äôinvestissement</b> ‚Äî vous pouvez participer avec le montant SOL de votre choix.</p>

        <div id="endedBanner" class="banner">
          Pr√©vente termin√©e ‚úÖ
          <small>ü•≥ Merci √† tous les participants ! Les tokens seront distribu√©s sous 24 h.</small>
        </div>

        <div class="row" id="liveKpi">
          <div class="kpi"><span class="muted">Prix</span><b>1 SOL = 1 000 000 FTEAM</b></div>
          <div class="kpi"><span class="muted">Objectif</span><b>20 SOL ‚Ä¢ 20 000 000 FTEAM</b></div>
          <div class="kpi"><span class="muted">P√©riode</span><b>12 ‚Üí 20 oct. 2025</b></div>
        </div>

        <div class="row" style="align-items:center">
          <div class="input" style="flex:1">
            <input id="payAddr" readonly value="85W5dCWr5bCGv1dfcELu1rnFR6BVdXVi9QU1yMTehVm1" />
            <button class="copy btn" onclick="copyAddr()">üìã Copier</button>
          </div>
          <button class="btn" onclick="openPhantom()">Ouvrir dans Phantom (mobile)</button>
        </div>

        <div class="links muted" style="margin-top:6px">
          Si le bouton ne s‚Äôouvre pas : <a id="phantomUL" href="#">ouvrir avec Phantom</a> ‚Ä¢ <a id="solanaPay" href="#">Solana Pay</a>
        </div>

        <div class="row" id="progressRow">
          <div style="flex:1">
            <div class="muted">Cl√¥ture dans</div>
            <div id="count" style="font-weight:800;font-size:24px;margin-top:2px">--:--:--</div>
          </div>
          <div style="flex:1">
            <div class="muted">Progression</div>
            <div class="bar"><i id="bar" style="width:0%"></i></div>
            <div class="muted" id="raised">0.00 SOL lev√©s / objectif 20 SOL</div>
            <div class="muted" id="counterErr" style="display:none;margin-top:4px;color:#ffb3b3">
              ‚õî Compteur indisponible (RPC). R√©essaie plus tard.
            </div>
          </div>
        </div>

        <ul class="steps">
          <li>1) Ouvrez Phantom et assurez-vous d'avoir du SOL.</li>
          <li>2) Copiez l'adresse ci-dessus et envoyez le montant souhait√©.</li>
          <li>3) Conservez la signature de transaction (re√ßu).</li>
          <li>4) Distribution des tokens FTEAM √† la fin de la pr√©sale.</li>
        </ul>

        <p class="muted">Adresse mint du token : <span id="mint">5h7oqn63Ub7t97ZqTD8saxpckVxT37KcpoBNbzxozbt</span></p>
      </section>

      <!-- Carte √† propos -->
      <aside class="card">
        <h3>√Ä propos de FTEAM</h3>
        <p>
          FTEAM incarne la meilleure communaut√© fran√ßaise de crypto. Objectif : cr√©er un hub Solana francophone solide
          avec utilit√©s progressives (r√©compenses, acc√®s priv√©s, √©v√©nements IRL).
        </p>
        <div class="row">
          <span class="kpi" style="flex:0 0 auto"><span class="muted">Chain</span><b>Solana</b></span>
          <span class="kpi" style="flex:0 0 auto"><span class="muted">Decimals</span><b>9</b></span>
          <span class="kpi" style="flex:0 0 auto"><span class="muted">Ticker</span><b>FTEAM</b></span>
        </div>
      </aside>
    </div>

    <footer class="muted" style="margin:24px 0 6px">
      ¬© <span id="year"></span> French Team ‚Äî FTEAM
    </footer>
  </div>

  <!-- Script -->
  <script>
    /* ========= Config ========= */
    const PRESALE_ADDRESS = "85W5dCWr5bCGv1dfcELu1rnFR6BVdXVi9QU1yMTehVm1";
    const RAISE_GOAL_SOL  = 20;
    const SALE_START      = new Date("2025-10-12T00:00:00Z").getTime();
    const SALE_END        = new Date("2025-10-20T23:59:59Z").getTime();

    /* Valeur affich√©e imm√©diatement pour les nouveaux (estimation) */
    const SEEDED_RAISED_SOL = 16.23;            // ‚Üê tu peux changer ce chiffre
    const CACHE_KEY = "fteam_raised_cache_v3";  // cl√© de cache (nouvelle)

    /* ========= En-t√™te / liens ========= */
    document.getElementById('year').textContent = new Date().getFullYear();

    const phantomUL = new URL('https://phantom.app/ul/v1/pay');
    phantomUL.searchParams.set('recipient', PRESALE_ADDRESS);
    phantomUL.searchParams.set('network', 'mainnet-beta');
    phantomUL.searchParams.set('label', 'FTEAM Presale');
    phantomUL.searchParams.set('message', 'Participate in FTEAM presale');

    const solanaPayHref = 'solana:' + PRESALE_ADDRESS + '?label=FTEAM%20Presale';
    document.getElementById('phantomUL').href = phantomUL.toString();
    document.getElementById('solanaPay').href = solanaPayHref;

    function copyAddr(){
      navigator.clipboard.writeText(PRESALE_ADDRESS).then(()=>{
        const btn = document.querySelector('.copy');
        const old = btn.textContent; btn.textContent='‚úî Copi√©';
        setTimeout(()=>btn.textContent=old,1200);
      });
    }

    function openPhantom(){
      const ua = navigator.userAgent||'';
      const isMobile  = /Android|iPhone|iPad|iPod/i.test(ua);
      const isAndroid = /Android/i.test(ua);
      if (isAndroid){
        const intent = 'intent://' + phantomUL.toString().replace('https://','') + '#Intent;scheme=https;package=app.phantom;end';
        window.location.href = intent;
        setTimeout(()=>{ window.location.href = solanaPayHref; }, 1200);
        return;
      }
      if (isMobile){
        window.location.href = phantomUL.toString();
        setTimeout(()=>{ window.location.href = solanaPayHref; }, 1200);
      } else {
        alert("Sur ordinateur, ouvrez Phantom et collez l‚Äôadresse.");
        window.open('https://phantom.app/','_blank');
      }
    }

    /* ========= Compte √† rebours ========= */
    function updateCountdown(){
      const now = Date.now();
      if (now > SALE_END){
        document.getElementById('endedBanner').style.display='block';
        document.getElementById('progressRow').style.display='none';
        document.getElementById('liveKpi').style.opacity=.65;
        return;
      }
      let diff = Math.max(0, SALE_END - now);
      const d = Math.floor(diff/86400000); diff%=86400000;
      const h = Math.floor(diff/3600000);  diff%=3600000;
      const m = Math.floor(diff/60000);    diff%=60000;
      const s = Math.floor(diff/1000);
      document.getElementById('count').textContent =
        `${d}j ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m ${String(s).padStart(2,'0')}s`;
    }
    setInterval(updateCountdown, 1000); updateCountdown();

    /* ========= Compteur (seed + cache + multi-RPC) ========= */
    const RPC_URLS = [
      "https://rpc.ankr.com/solana",
      "https://mainnet.helius-rpc.com/?api-key=8ff2e734-290b-483b-a65b-c90e0ccdb1ca",
      "https://rpc.helius.xyz/?api-key=8ff2e734-290b-483b-a65b-c90e0ccdb1ca",
      "https://mainnet.helius-rpc.com/?api-key=bc7aa527-188f-4f0a-bb15-db6bc650b642",
      "https://rpc.helius.xyz/?api-key=bc7aa527-188f-4f0a-bb15-db6bc650b642"
    ];
    const LAMPORTS_PER_SOL = 1_000_000_000;
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

    function showErr(msg){
      const e = document.getElementById('counterErr');
      e.textContent = '‚õî ' + msg;
      e.style.display = 'block';
    }
    function readCache(){ try{ return JSON.parse(localStorage.getItem(CACHE_KEY)||'null'); }catch{ return null; } }
    function writeCache(v){ try{ localStorage.setItem(CACHE_KEY, JSON.stringify({value:v,ts:Date.now()})); }catch{} }

    /* 1) Affichage imm√©diat : seed si pas de cache, sinon cache */
    (function seedFirstPaint(){
      const cached = readCache();
      if (!cached){
        const pct = Math.min(100, (SEEDED_RAISED_SOL/RAISE_GOAL_SOL)*100);
        document.getElementById("raised").textContent =
          `${SEEDED_RAISED_SOL.toFixed(2)} SOL lev√©s / objectif ${RAISE_GOAL_SOL} SOL (estim.)`;
        document.getElementById("bar").style.width = pct.toFixed(1) + "%";
      } else {
        const v = cached.value;
        const pct = Math.min(100, (v/RAISE_GOAL_SOL)*100);
        document.getElementById("raised").textContent =
          `${v.toFixed(2)} SOL lev√©s / objectif ${RAISE_GOAL_SOL} SOL (cache)`;
        document.getElementById("bar").style.width = pct.toFixed(1) + "%";
      }
    })();

    async function rpc(method, params){
      const notes = [];
      for (const url of RPC_URLS){
        try{
          const r = await fetch(url, {
            method:"POST",
            headers:{"content-type":"application/json"},
            body:JSON.stringify({jsonrpc:"2.0", id:1, method, params})
          });
          if (!r.ok){
            if (r.status===429){ notes.push('429 '+(new URL(url)).host); continue; }
            throw new Error('HTTP '+r.status+' via '+(new URL(url)).host);
          }
          const j = await r.json();
          if (j.error){
            if (j.error.code===-32429){ notes.push('rate '+(new URL(url)).host); continue; }
            throw new Error(j.error.message);
          }
          return j.result;
        }catch(e){ notes.push(e.message); }
      }
      throw new Error(notes.join(' | '));
    }

    async function* signaturesForAddress(address, untilTsMin){
      let before=null;
      while(true){
        const res = await rpc("getSignaturesForAddress", [address,{limit:1000,before,commitment:"confirmed"}]);
        if(!res || !res.length) break;
        for(const s of res) yield s;
        before = res[res.length-1].signature;
        const lastTs = (res[res.length-1].blockTime||0)*1000;
        if(lastTs && lastTs<untilTsMin) break;
        await sleep(200);
      }
    }

    async function getParsedTxBatch(sigs){
      try{
        return await rpc("getParsedTransactions",[sigs,{maxSupportedTransactionVersion:0}]);
      }catch(e){
        // Fallback signature par signature si getParsedTransactions rate
        const out=[];
        for(const sig of sigs){
          try{
            const tx=await rpc("getTransaction",[sig,{maxSupportedTransactionVersion:0,commitment:"confirmed",encoding:"jsonParsed"}]);
            out.push(tx); await sleep(80);
          }catch{ out.push(null); }
        }
        return out;
      }
    }

    async function computeRaisedSOL(){
      let lamportsIn=0;
      const sigs=[];
      for await (const s of signaturesForAddress(PRESALE_ADDRESS, SALE_START)){
        const ts=(s.blockTime||0)*1000;
        if (ts && ts>SALE_END) continue;
        if (ts && ts<SALE_START) break;
        if (s.err) continue;
        sigs.push(s.signature);
        if (sigs.length>=400) break; // suffisant pour une pr√©sale
      }
      for(let i=0;i<sigs.length;i+=100){
        const chunk=sigs.slice(i,i+100);
        const txs = await getParsedTxBatch(chunk);
        for(const tx of txs||[]){
          if(!tx || tx.meta?.err) continue;
          const tms=(tx.blockTime||0)*1000;
          if(tms && (tms<SALE_START || tms>SALE_END)) continue;
          for(const ins of tx.transaction?.message?.instructions||[]){
            const info=ins.parsed?.info;
            if(ins.program==="system" && ins.parsed?.type==="transfer" && info?.destination===PRESALE_ADDRESS){
              lamportsIn += Number(info.lamports||0);
            }
          }
        }
        await sleep(220);
      }
      return lamportsIn / LAMPORTS_PER_SOL;
    }

    async function updateRaisedUI(){
      try{
        const raised = await computeRaisedSOL();
        writeCache(raised);
        const pct = Math.min(100,(raised/RAISE_GOAL_SOL)*100);
        document.getElementById("raised").textContent =
          `${raised.toFixed(2)} SOL lev√©s / objectif ${RAISE_GOAL_SOL} SOL`;
        document.getElementById("bar").style.width = pct.toFixed(1)+"%";
        document.getElementById("counterErr").style.display="none";
      }catch(e){
        showErr(e.message||"Compteur indisponible (RPC).");
      }
    }

    /* D√©marrage : on laisse d‚Äôabord afficher le seed/cache, puis on calcule en live */
    ("requestIdleCallback" in window ? requestIdleCallback : (fn=>setTimeout(fn,1200)))(()=>updateRaisedUI());
    setInterval(updateRaisedUI, 300000); // rafra√Æchit toutes les 5 min
  </script>
</body>
</html>
